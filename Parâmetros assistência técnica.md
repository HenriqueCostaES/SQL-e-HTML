```sql
--Principal
SELECT 
    CAB.CODEMP,
    EMP.NOMEFANTASIA,
    COUNT(TEC.NUNOTA) QTD_TOTAL,
    COUNT(CASE WHEN STATUSCRM IN (SELECT ID FROM AD_TJKSTATUSCRM WHERE ID_FINALIZADO = 'S') THEN 1 END) AS Finalizado,
    COUNT(CASE WHEN STATUSCRM IN (SELECT ID FROM AD_TJKSTATUSCRM WHERE ID_FINALIZADO = 'N') THEN 1 END) AS Em_Aberto
    FROM AD_ASSISTENCIATEC TEC
    LEFT JOIN AD_ITENSGARANTIA TIA ON TIA.NUNOTA = TEC.NUNOTA
    LEFT JOIN TGFCAB CAB ON CAB.NUNOTA = TEC.NUNOTA
    LEFT JOIN TSIEMP EMP ON EMP.CODEMP = CAB.CODEMP
    LEFT JOIN TGFVEN VEN ON VEN.CODVEND = CAB.CODVEND
    LEFT JOIN TGFPAR PAR ON PAR.CODPARC = CAB.CODPARC
    LEFT JOIN TGFPRO PRO ON PRO.CODPROD = TIA.CODPROD
    LEFT JOIN AD_MOTIVOSGARANTIA MOT ON MOT.CODMOTIVO = TIA.CODMOTIVO
WHERE
    TIA.DTLANCAMENTO BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN
    AND CAB.CODEMP IN :P_EMPRESA
    AND 
    (
        PRO.MARCA IN :P_MARCA
    )
    AND TIA.CODMOTIVO IN :P_MOTIVO
    AND
     (
        :P_MONTADOR IS NULL 
        OR CAB.AD_CODPARCMONT IN :P_MONTADOR
    )
GROUP BY
CAB.CODEMP,
EMP.NOMEFANTASIA
ORDER BY 
QTD_TOTAL DESC,
Finalizado DESC,
Em_aberto DESC
```
```sql
--Detalhado
SELECT     
    TEC.NUNOTA,
    CAB.CODEMP,
    CAB.AD_CODPARCMONT,
    PRO.MARCA,
    TIA.CODMOTIVO,
    MOT.DESCRMOTIVO,
    CASE 
        WHEN STATUSCRM IN (SELECT ID FROM AD_TJKSTATUSCRM WHERE ID_FINALIZADO = 'S') THEN 'Finalizado' 
        ELSE 'Em aberto'
    END STATUS
FROM AD_ASSISTENCIATEC TEC
LEFT JOIN AD_ITENSGARANTIA TIA ON TIA.NUNOTA = TEC.NUNOTA
LEFT JOIN TGFCAB CAB ON CAB.NUNOTA = TEC.NUNOTA
LEFT JOIN TSIEMP EMP ON EMP.CODEMP = CAB.CODEMP
LEFT JOIN TGFVEN VEN ON VEN.CODVEND = CAB.CODVEND
LEFT JOIN TGFPAR PAR ON PAR.CODPARC = CAB.CODPARC
LEFT JOIN TGFPRO PRO ON PRO.CODPROD = TIA.CODPROD
LEFT JOIN AD_MOTIVOSGARANTIA MOT ON MOT.CODMOTIVO = TIA.CODMOTIVO
WHERE
    TIA.DTLANCAMENTO BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN
    AND CAB.CODEMP IN :A_EMPRESA
    AND 
    (
        PRO.MARCA IN :P_MARCA
    )
    AND TIA.CODMOTIVO IN :P_MOTIVO
    AND
     (
        :P_MONTADOR IS NULL 
        OR CAB.AD_CODPARCMONT IN :P_MONTADOR
    )

ORDER BY
    TIA.CODMOTIVO
```
